# ==============================================================================
# metafile.yaml â€” Binutils (Pass 1)
# Local: /usr/ports/toolchain/binutils-pass1/metafile.yaml
# CompatÃ­vel com LFS 12.x â€” Etapa Toolchain inicial
# ==============================================================================

# ğŸ·ï¸ IdentificaÃ§Ã£o do pacote
name: binutils-pass1
version: 2.43.1
release: 1
epoch: 0
category: toolchain
summary: "Binutils - Pass 1 (toolchain inicial)"
description: |
  Este pacote compila o conjunto de ferramentas Binutils (assembler, linker,
  etc.) para o ambiente de construÃ§Ã£o inicial do LFS (Pass 1).
  Ele Ã© usado para criar o toolchain isolado em /mnt/lfs/tools e serÃ¡
  substituÃ­do pelo Binutils Pass 2 posteriormente.

# ğŸ§© EstÃ¡gio
stage: pass1

# ğŸŒ Fontes
source:
  - https://ftp.gnu.org/gnu/binutils/binutils-2.43.1.tar.xz
  - https://ftpmirror.gnu.org/binutils/binutils-2.43.1.tar.xz

checksums:
  sha256: 4e5185ebc501fb31cf7d223a6c91162e8b7e77f67fb4d5c8e6e5b04d0e8c7d47

build_dir: binutils-2.43.1

# ğŸ“¦ Ambiente
environment:
  LFS: "/mnt/lfs"
  LFS_TGT: "$(uname -m)-lfs-linux-gnu"
  PATH: "/mnt/lfs/tools/bin:/usr/bin:/bin"
  CONFIG_SITE: "/usr/share/config.site"
  MAKEFLAGS: "-j$(nproc)"
  SHELL: "/bin/bash"
  LANG: "C.UTF-8"
  LC_ALL: "POSIX"

# ğŸ§± DependÃªncias
depends:
  build:
    - gcc
    - glibc
  runtime:
    - bash

bootstrap_tools:
  - gcc
  - make
  - coreutils

# ğŸ“œ InstruÃ§Ãµes de construÃ§Ã£o (do LFS)
build:
  - mkdir -pv build
  - cd build
  - ../configure \
        --prefix=/mnt/lfs/tools \
        --with-sysroot=/mnt/lfs \
        --target=$LFS_TGT \
        --disable-nls \
        --enable-gprofng=no \
        --disable-werror
  - make

# ğŸ“¥ InstalaÃ§Ã£o
install:
  - make install
  - install -vdm755 /mnt/lfs/tools/lib && ln -sv lib /mnt/lfs/tools/lib64 || true

# ğŸ“œ Testes (omitidos no Pass 1 para acelerar a build)
test: []

# ğŸ§¹ Limpeza
cleanup:
  - rm -rf $PWD/build

# ğŸ§· Hooks (opcionais)
hooks:
  pre_build: scripts/pre-build.sh
  post_build: scripts/post-build.sh
  post_install: scripts/post-install.sh

# ğŸ§¾ Metadata
metadata:
  maintainer: "Fernando Canata <fernando@example.org>"
  license: GPL-3.0-or-later
  homepage: https://www.gnu.org/software/binutils/
  repository: https://www.linuxfromscratch.org/lfs/view/stable/
  section: "Toolchain Stage 1"

# âš™ï¸ PolÃ­ticas especÃ­ficas
build_policy:
  continue_on_error: false
  sandbox: true
  fakeroot: false
  require_chroot: true
  run_as_user: lfs
  preserve_env: false
  isolated_env: true

# ğŸ”’ SeguranÃ§a
security:
  sandbox: true
  drop_privileges: true
  forbid_root_build: true
  restricted_network: true

# ğŸ§© Empacotamento
package:
  format: tar.zst
  compression_level: 19
  output_dir: /mnt/lfs/packages
  include_docs: false
  include_manpages: false
  include_locales: false

# ğŸ§¾ Notas
notes: |
  Binutils Pass 1 deve ser construÃ­do antes do GCC Pass 1.
  O diretÃ³rio /mnt/lfs/tools deve estar criado e no PATH antes do build.
  O usuÃ¡rio 'lfs' deve ter permissÃ£o de escrita em /mnt/lfs/tools.

  Comando recomendado de build:
    sudo -u lfs newpkg --config /etc/newpkg/newpkg_lfs.yaml install binutils-pass1
